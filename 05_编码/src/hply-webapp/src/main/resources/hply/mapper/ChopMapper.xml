<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hply.mapper.ChopMapper">

	<cache />


	<select id="getRowCountByOrganization" resultType="int">
		select count(*) from t_chop where
		organization_id=#{organizationId}
	</select>

	<select id="getAllPagedByOrganization" resultType="Chop">
		select id as id, chop_code as chopCode, project_id as
		projectId, project_code as projectCode, project_name as projectName,
		manager as manager, content as content, apply_user
		as applyUser, apply_time as applyTime, organization_id as
		organizationId, step1_idea as step1Idea, step1_user as
		step1User, step1_time as step1Time, step2_idea as step2Idea,
		step2_user as step2User, step2_time as step2Time,
		step3_idea as step3Idea, step3_user as step3User, step3_time as
		step3Time, step_status as stepStatus, version as
		version, status as status, field_01 as field01, field_02 as field02,
		field_03 as field03, field_04 as field04, field_05
		as field05 from t_chop where organization_id=#{organizationId} limit #{pageSize} offset #{pageIndex}
	</select>

	<select id="getMonths" resultType="string">
		select distinct date_format(date(apply_time) + interval + 11 day, '%Y-%m')
		from t_chop order by
		apply_time desc
	</select>

	<select id="getChopReport" resultType="Chop">
		select apply_user applyUser, apply_time applyTime, project_name projectName, content,
		step3_user step3User, manager
		from t_chop where step3_user is not null and apply_time between date(concat(#{p1}, '-21')) -
		interval + 1 month and
		date(concat(#{p2}, '-21')) - interval + 1 day and organization_id = #{organizationId} order by
		apply_time
	</select>
</mapper>

